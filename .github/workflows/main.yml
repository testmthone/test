# Workflow'un adı: GitHub'daki Actions sekmesinde bu isimle görünecek
name: Deploy Test Projesi

# Tetikleyici: 'main' branch'ine her 'push' yapıldığında bu workflow çalışır
on:
  push:
    branches: [ main ]

# Yapılacak işler
jobs:
  # 'deploy' adında bir iş tanımlıyoruz
  deploy:
    # Bu iş, GitHub'ın bize sağladığı en güncel Ubuntu sanal makinesinde çalışacak
    runs-on: ubuntu-latest

    steps:
    # Adım 1: SSH bağlantısı kur ve sunucuda komutları çalıştır
    - name: Deploy to Server via SSH
      # Bu işi kolaylaştıran hazır bir GitHub Action'ı kullanıyoruz
      uses: appleboy/ssh-action@v1.0.3
      # 'with' bloğu, bu Action'a gönderdiğimiz ayarları içerir
      with:
        # Sunucu adresi, kullanıcı adı ve özel anahtar, GitHub Secrets'tan güvenli bir şekilde çekiliyor
        host: ${{ secrets.SSH_HOST }}
        username: ${{ secrets.SSH_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        port: 22 # Standart SSH portu

        # Sunucuda çalıştırılacak komutlar dizisi
        script: |
          echo "Deployment basliyor..."
          cd /var/www/test-projesi
          echo "Proje klasorune girildi."
          git pull origin main
          echo "Guncellemeler GitHub'dan cekildi."
          echo "Deployment tamamlandi!"
